<html><head>
  <title>Hull SQL</title>
  <link rel="stylesheet" href="//dd04rofzygnm0.cloudfront.net/releases/master/865f04865d2448286626bac92c518a8f8ea8bafe/stylesheets/neue.css">
  <script src="/ship.js" type="text/javascript" charset="utf-8" async defer></script>
</head>
<body>
  <div class="row">
    <div class="col-xs-offset-1 col-xs-10 col-lg-10 col-lg-offset-1 panel mt-2">
      <div class="panel-body">

        <div class="mb-1 ps-3">

          <h1 class="mb-0 mt-05 text-center"><i class="icon icon-hull" style="font-size:64px;"></i> </h1>

          <div class="mb-1 media pb-1">
            <div class="media-left">
              <div class="media-object pr-1 pt-1">
                <div class="check valid"><i class="icon icon-valid"></i></div>
              </div>
            </div>
            <div class="media-body pt-1">
              <h4 class="m-0 pt-05 text-muted">Connected to your <%= db_type %> database</h4>
            </div>
          </div>
          <% if (last_sync_at) { %>
          <h5>Last Sync <small class="pull-right">on <span data-time=""><%= last_sync_at %></span></small></h5>
          <% } %>
          <hr>
          <div class="row">
            <div class="col-sm-12">
              <h4 class="mt-0 text-muted">SQL Query</h4>
              <div class="row mb-1">
                <div class="col-sm-12 col-lg-8">
                  <textarea name="" rows="15" id="querying" class="form-control"><%= query %></textarea>
                </div>
                <div class="col-sm-12 col-lg-4">
                  <div class="alert alert-info">
                    <h4 class='mt-05 mb-0'>Preview &amp; Save queries</h4>
                    <p>Each time you change your query, you <strong>must</strong> run a successful preview by clicking the <strong>Preview</strong> below before you can <strong>Save it</strong> (with the Save button on the top right of this screen)</p>
                    <small>In preview mode, your query will be run with a <code>LIMIT 100</code> or <code>TOP(100)</code> in T-SQL</small>
                  </div>
                  <div class="mt-1 mb-1">
                    <button id="button_preview" class="mb-1 btn-block btn-pill btn-rounded btn-success btn to-disable"><i class="icon icon-eye_open"></i> Preview</button>
                    <button id="button_import" class="mb-1 btn-block btn-pill btn-rounded btn-danger btn to-disable"><i class="icon icon-reset"></i> Import everything</button>
                  </div>
                </div>
              </div>

              <hr>

              <h4 class="text-muted">Results Preview <span id="results-title"></span></h4>

              <div id="error-query" class="alert alert-danger">
              </div>

              <div id="preview-query" class="alert alert-success">
                Click "Preview" to see what the query returns. You need to preview before you can save.
              </div>

              <div id="loading-query" class="alert alert-warning">
                Loading. Please wait.
              </div>

              <table id="result" class="table table-striped table-responsive table-bordered table-condensed">
                <thead>
                  <tr></tr>
                </thead>
                <tbody>
                </tbody>
              </table>

              <hr>



              <div class="row">
                <div class="col-sm-12 col-md-6">
                  <div class="well">
                    <h6>How to write valid queries</h6>
                    <% if (typeof import_type !== "undefined" && import_type == "accounts") { %>
                      <p>
                        Valid queries MUST expose an <code>external_id</code> column or a <code>domain</code> column. Lines with no <code>external_id</code> or <code>domain</code> will be ignored.
                        All other fields will be imported as traits on the matching account.
                        For example, the following query will map the column <code>account.id</code> to your Hull accounts' <code>external_id</code>.
                        <pre><code>SELECT account_id as external_id, plan_name, monthly_amount FROM accounts_subscriptions</code></pre>
                      </p>
                    <% } else if (typeof import_type !== "undefined" && import_type == "events") { %>
                      <p>
                      Valid queries MUST expose an <code>external_id</code> column matching a user, an <code>event</code> colums specifying the event name or type and a <code>timestamp</code> column. Lines with no <code>external_id</code>, <code>event</code> and <code>timestamp</code> will be ignored.
                        All other fields will be imported as event properties.
                        For example, the following query will map the column <code>users.id</code> to your Hull users' <code>external_id</code>.
                        <pre><code>SELECT user_id as external_id, event, timestamp FROM users_events</code></pre>
                      You can also provide an <code>event_id</code> column to ensure event unicity.
                      </p>
                    <% } else { %>
                      <p>
                        Valid queries MUST expose an <code>external_id</code> column or an <code>email</code> column. Lines with no <code>external_id</code> or <code>email</code> will be ignored.
                        All other fields will be imported as traits on the matching users.
                        For example, the following query will map the column <code>users.id</code> to your Hull users' <code>external_id</code>.
                        <pre><code>SELECT user_id as external_id, plan_name, monthly_amount FROM users_subscriptions</code></pre>
                        You can also expose an <code>account_id</code> column to link users to an account. <code>account_id</code> will be used to resolve an account by its <code>external_id</code>.
                      </p>
                    <% } %>
                  </div>
                </div>
                <div class="col-sm-12 col-md-6">
                  <div class="well">
                    <h6>Incremental Queries</h6>
                    <p>
                      To reduce load on your database, you can run incremental queries based on the number of days to import.
                      <br />
                      The query will be rewritten to replace <code>:import_start_date</code> with the date in past set according to Import Days setting.
                      <br /><br />
                      For example to import entries from a <code>users</code> table with a date column named <code>updated_at</code>, you can write :
                      <pre><code>SELECT id as external_id, email as email, firstname as first_name FROM users WHERE updated_at >= :import_start_date</code></pre>
                    </p>
                  </div>
                </div>
              </div>

            </div>
          </div>

        </div>
    </div>
  </div>
  <style type="text/css" media="screen">
    .alert.alert-danger {
      background-color: #f3502f;
      border-color: #fffaf9;
      color: #ffffff;
    }
    #error-query, #loading-query {
      display: none;
    }
    .check i.icon {
      color: rgba(75, 222, 122, 0.52);
      font-size: 2pc;
      position: relative;
      top: -11px;
      left: 3px;
    }
    .check.valid {
      border-color: rgba(75, 222, 122, 0.52);
    }
    .check {
      border-radius: 100px;
      border: 2px solid transparent;
      padding: 0 5px;
      height: 37px;
      width: 37px;
      position: relative;
    }
    th em {
      color: #8091AD;
      font-size: .8em;
    }
    #querying {
      font-family:  Menlo, Monaco, Consolas, "Courier New", monospace;
      font-size: 12px;
    }
    .CodeMirror {
      border: 1px solid #e6e6e6;
    }
    th em {
      display: block;
    }
    td pre {
      margin: 0;
    }
  </style>
</body></html>
